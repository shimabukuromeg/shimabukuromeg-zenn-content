---
title: "GraphQL ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã« microCMS ã‚’ ä½¿ã†"
emoji: "ğŸ‘¨ğŸ¼â€ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["graphql", "microcms"]
published: true
publication_name: "monicle"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã§ã¯ã€GraphQL ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã« microCMS ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚GraphQL ã¯ BFF ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚å¤šã„ã§ã™ãŒã€GraphQL ã¨ã—ã¦ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒã©ã“ã‹ã‚‰æ¥ãŸã®ã‹ã¯é‡è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ RESTful APIã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å–å¾—ã™ã‚‹ã¨ã„ã£ãŸé¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ microCMS ã‚’ãƒ‡ãƒ¼ã‚¿å–å¾—å…ƒã«ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã€ãã®æ§‹æˆã‚„æ§‹ç¯‰æ‰‹é †ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚ï¼ˆä»¥ä¸‹ã®å›³ã® REST API ã®éƒ¨åˆ†ãŒ mciroCMS ã«ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ï¼‰

**GraphQL is data source agnostic**

![](https://storage.googleapis.com/zenn-user-upload/c8241c3d2290-20240302.png)
_å‡ºå…¸: https://www.apollographql.com/blog/graphql/basics/what-is-graphql-introduction/_

# ãªãœ microCMS ã‚’ä½¿ã„ãŸã„ã®ã‹

microCMS ã‚’ GraphQL ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ã—ã¦åˆ©ç”¨ã—ãŸã„ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã¯ã€GraphQL ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ãŒè¤‡æ•°ã‚ã‚Šã€microCMS ã§ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ãã‚Œä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’é€£æºã•ã›ãŸã„ã€ã¨ã„ã£ãŸã‚±ãƒ¼ã‚¹ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

ä¾‹. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã« microCMS(REST API) ã¨ Database ãŒã‚ã‚Šã€microCMS ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æƒ…å ±ã¨åˆã‚ã›ã¦ Database ã§ç®¡ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€ç·’ã«è¿”ã—ãŸã„ã€‚

# åˆ©ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

åˆ©ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç´¹ä»‹ã—ã¾ã™ã€‚GraphQL Server ã« graphql-yogaã€ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã« gcg-typescript-resolver-files ã¨ microcms_sdk_generator ã‚’ä½¿ã„ã¾ã™ã€‚ãã‚Œãã‚Œ GraphQL ã®ã‚¹ã‚­ãƒ¼ãƒã€microCMS ã® API ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ã€ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

**graphql-yoga**
GraphQL Server

https://github.com/dotansimha/graphql-yoga

**gcg-typescript-resolver-files**
GraphQL Server å´ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

https://github.com/eddeee888/graphql-code-generator-plugins/tree/master/packages/typescript-resolver-files

**microcms_sdk_generator**
microCMS ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://github.com/hori-ryota/microcms_sdk_generator

# graphql-yoga ã®ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹

ã¾ãšã¯ GraphQL Yoga ã‚’ä½¿ã£ã¦ GraphQL ã‚µãƒ¼ãƒãƒ¼ã®ç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã„ãã¾ã™ã€‚

**1. GraphQL Yoga ã¨ã¯**
graphql-yoga ã¯ã€å¤šãã® GraphQL é–¢é€£ã® OSS ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã‚‹ The Guild ãŒä½œã£ã¦ã„ã‚‹ OSS ã§ã€ GraphQL Server ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
ç´°ã‹ã„ã‚¹ãƒšãƒƒã‚¯ã®ç´¹ä»‹ã¯ã€å…¬å¼ã®ãƒšãƒ¼ã‚¸ã«è­²ã‚Šã¾ã™ãŒã€Nodejsã€Denoã€Cloudflare Workers ãªã©æ§˜ã€…ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§å‹•ã‹ã›ã‚‹ã“ã¨ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒå……å®Ÿã—ã¦ã‚‹ãªã©ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚

https://the-guild.dev/graphql/yoga-server/docs/comparison

**2. ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹æ–¹æ³•**
å…¬å¼ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ã€æ‰‹å…ƒã§ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ç´°ã‹ã„æ‰‹é †ã¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã™ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚ä¸€é€šã‚Šæµã™ã¨æ‰‹å…ƒã§å‹•ãç’°å¢ƒã‚’ç”¨æ„ã§ãã¾ã™ã€‚

https://the-guild.dev/graphql/yoga-server/tutorial/basic

**3. GraphQL Yoga ã®æ¨ã—ãƒã‚¤ãƒ³ãƒˆ**
å€‹äººçš„ã«ã€GraphQL Code Generator ã‚’ã¯ã˜ã‚ã€GraphQL å…¨ä½“ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­å¿ƒã« The Guild ãŒã‚ã‚‹ã‚ˆã†ãªå°è±¡ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰æä¾›ã•ã‚Œã¦ã‚‹å®‰å¿ƒæ„Ÿã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚ã‹ã‚Šã‚„ã™ã•ã€æ—¢ã«å¤šãã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã‚‹ä¾¿åˆ©ã•ãªã©ãŒã€æ¨ã—ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

https://the-guild.dev/about-us

# gcg-typescript-resolver-files ã‚’å°å…¥ã™ã‚‹

ç¶šã„ã¦ã€gcg-typescript-resolver-files ã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚

**1. gcg-typescript-resolver-files ã¨ã¯**
GraphQL ã®ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ã€è¦ç´„ã«å¾“ã£ã¦ resolver ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ‡ã‚Šã€ãã‚Œãã‚Œã«ã‚¹ã‚­ãƒ¼ãƒã‚’é…ç½®ã—ã¦ã€`graphql-codegen --config ./codegen.ts` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†ã‘ãŸå˜ä½ã§ resolver ã®ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```bash
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ schema/
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
â”‚   â”‚   â”œâ”€â”€ book/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
```

è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```bash
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ schema/
â”‚   â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”œâ”€â”€ resolvers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Query/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts            # Generated, changes not overwritten by codegen
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts                # Generated, changes not overwritten by codegen
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
â”‚   â”‚   â”œâ”€â”€ book/
â”‚   â”‚   â”‚   â”œâ”€â”€ resolvers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Query/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ book.ts            # Generated, changes not overwritten by codegen
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Mutation/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ markBookAsRead.ts  # Generated, changes not overwritten by codegen
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Book.ts                # Generated, changes not overwritten by codegen
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.graphql
â”‚   â”‚   â”œâ”€â”€ resolvers.generated.ts         # Entirely generated by codegen
â”‚   â”‚   â”œâ”€â”€ typesDefs.generated.ts         # Entirely generated by codegen
â”‚   â”‚   â”œâ”€â”€ types.generated.ts             # Entirely generated by codegen
```

è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¦ã€é–‹ç™ºè€…ãŒã‚„ã‚‰ãªã„ã‘ã‚Œã°ã„ã‘ãªã„ä½œæ¥­ã¯ã€æœªå®Ÿè£…ã®ãƒ­ã‚¸ãƒƒã‚¯ã®éƒ¨åˆ†ã‚’åŸ‹ã‚ã‚Œã°ã„ã„ã ã‘ã€ã¨ã„ã†æ„Ÿã˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

```typescript
import type { QueryResolvers } from "./../../../types.generated";
export const user: NonNullable<QueryResolvers["user"]> = async (
  _parent,
  _arg,
  _ctx
) => {
  /* Implement Query.user resolver logic here */
  // ã“ã“ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã®ã¿
};
```

**2. å°å…¥æ–¹æ³•**
å°å…¥æ–¹æ³•ã¯å…¬å¼ã®ã‚¬ã‚¤ãƒ‰ãŒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ã€è©³ç´°ãªæ‰‹é †ã¯å…¬å¼ã‚¬ã‚¤ãƒ‰ã‚’å‚ç…§ãã ã•ã„ã€‚graphql-yoga ã® tutorial ã‚’æµã—ãŸç’°å¢ƒã§ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã®ã‚¬ã‚¤ãƒ‰ã‚’æ‰‹é †é€šã‚Šè©¦ã™ã“ã¨ã§ã€ gcg-typescript-resolver-files ã‚’å°å…¥ã§ãã¾ã™ã€‚

https://the-guild.dev/graphql/codegen/docs/guides/graphql-server-apollo-yoga-with-server-preset

**3. gcg-typescript-resolver-files ã®æ¨ã—ãƒã‚¤ãƒ³ãƒˆ**
resolver ãŒè¿”ã•ãªã„ã¨ã„ã‘ãªã„å‹ã‚‚ GraphQL ã®ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚æ®‹ã‚Šã®å®Ÿè£…ã¯ãƒ‘ã‚ºãƒ«ã®ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†ã‚’æ›¸ãã ã‘ãªã®ã§ã€é–‹ç™ºä½“é¨“ãŒã™ã”ãè‰¯ã‹ã£ãŸã§ã™ã€‚

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œè€…ã®æ°—æŒã¡ã¨ã—ã¦ã¯ã€API é–‹ç™ºã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ã‚‹ãŸã‚ã«ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹éš›ç™ºç”Ÿã™ã‚‹æ§˜ã€…ãªå•é¡Œã«å¯¾å‡¦ã™ã¹ãã€ä¾‹ãˆã°ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«ã‚ˆã‚‹è¦ç´„ã‚’ä½œã£ãŸã‚Šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã”ã¨ã«ã‚ªãƒ¼ãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚’æŒã£ã¦ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåˆ†ã‹ã‚Œã‚‹æ§‹æˆã‚’å¼·åˆ¶ã™ã‚‹ãªã©ã®è§£æ±ºç­–ã‚’æä¾›ã—ã¾ã™ã€‚è©³ç´°ã¯ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚‹ã®ã§ãŠã™ã™ã‚ã§ã™ã€‚

https://the-guild.dev/blog/scalable-apis-with-graphql-server-codegen-preset

# microcms_sdk_generator ã‚’å°å…¥ã™ã‚‹

ç¶šã„ã¦ã¯ã€microcms_sdk_generator ã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚

**1. microcms_sdk_generator ã¨ã¯**
microCMS ã® API ã‚¹ã‚­ãƒ¼ãƒã® json ã‹ã‚‰ client ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä½œè€…ã«ã‚ˆã‚‹ãƒ„ãƒ¼ãƒ«ã®ç´¹ä»‹è¨˜äº‹ãŒã€ä½œã£ãŸèƒŒæ™¯ã€å°å…¥æ–¹æ³•ãªã©ã€ã‚ã‹ã‚Šã‚„ã™ãã¦ãŠã™ã™ã‚ã§ã™ã€‚

https://hori-ryota.com/blog/create-microcms-sdk-generator/

**2. å°å…¥æ–¹æ³•**
:::message
äº‹å‰ã« microCMS ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ API ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã€ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãŒæ¸ˆã‚“ã§ã„ã‚‹å‰æã«ãªã‚Šã¾ã™ã€‚https://document.microcms.io/manual/getting-started
:::

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
$ pnpm i microcms_sdk_generator
$ pnpm i zod
```

microCMS ã®ç®¡ç†ç”»é¢ã‹ã‚‰ API ã‚¹ã‚­ãƒ¼ãƒã‚’ json å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã‚‹ã®ã§å–å¾—ã—ã¾ã™ã€‚

<!-- textlint-disable ja-technical-writing/ja-no-mixed-period -->

:::details ä¾‹. microCMS ã®ç®¡ç†ç”»é¢ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ« blog.json ã®è©³ç´°

ä»¥ä¸‹ã®å½¢å¼ã® json ã«ãªã£ã¦ã„ã¾ã™ã€‚

```json
{
  "apiFields": [
    {
      "idValue": "7EwsUooATH",
      "fieldId": "title",
      "name": "ã‚¿ã‚¤ãƒˆãƒ«",
      "kind": "text",
      "required": true,
      "isUnique": false
    },
    {
      "fieldId": "category",
      "name": "ã‚«ãƒ†ã‚´ãƒªãƒ¼",
      "kind": "relation",
      "required": true
    },
    {
      "fieldId": "author",
      "name": "è‘—è€…",
      "kind": "relation",
      "required": true
    },
    { "fieldId": "image", "name": "ç”»åƒ", "kind": "media" },
    {
      "fieldId": "body",
      "name": "æœ¬æ–‡",
      "kind": "richEditorV2",
      "required": true
    }
  ],
  "customFields": []
}
```

å–å¾—æ–¹æ³•ã¯ microCMS ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ãã ã•ã„ã€‚
https://document.microcms.io/manual/export-and-import-api-schema

:::

<!-- textlint-enable -->

å–å¾—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§é…ç½®ã—ã¾ã™ã€‚
ã“ã“ã§é…ç½®ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã¯ã€microCMS ã® API åã¨åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚(ä¾‹. blog ã® API ã‚¹ã‚­ãƒ¼ãƒã ã£ãŸã‚‰ã€blog.json ã«ã™ã‚‹)

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«ãƒ«ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»»æ„ã®åå‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
 $ mkdir ./micro-cms-schemas
 $ tree ./micro-cms-schemas
 ./micro-cms-schemas
 â”œâ”€â”€ list
 â”‚Â Â  â”œâ”€â”€ author.json # microCMSã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸAPIã‚¹ã‚­ãƒ¼ãƒã‚’é…ç½®ã™ã‚‹
 â”‚Â Â  â”œâ”€â”€ blog.json # microCMSã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸAPIã‚¹ã‚­ãƒ¼ãƒã‚’é…ç½®ã™ã‚‹
 â”‚Â Â  â””â”€â”€ category.json # microCMSã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸAPIã‚¹ã‚­ãƒ¼ãƒã‚’é…ç½®ã™ã‚‹
 â””â”€â”€ object
```

![](https://storage.googleapis.com/zenn-user-upload/1c1ab562e919-20240303.png)

ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™ãŒã§ããŸã‚‰ã€ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
$ npx microcms_sdk_generator ./micro-cms-schemas ./micro-cms-schemas/generated.ts
```

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€generated.ts ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```bash
 $ mkdir ./micro-cms-schemas
 $ tree ./micro-cms-schemas
 ./micro-cms-schemas
 â”œâ”€â”€ generated.ts # ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
 â”œâ”€â”€ list
 â”‚Â Â  â”œâ”€â”€ author.json
 â”‚Â Â  â”œâ”€â”€ blog.json
 â”‚Â Â  â””â”€â”€ category.json
 â””â”€â”€ object
```

generated.ts ã«ã¯ã‚¹ã‚­ãƒ¼ãƒã®å‹å®šç¾©ã‚„ API ã‚’å©ãé–¢æ•°ãªã©ãŒç”¨æ„ã•ã‚Œã¾ã™ã€‚æŠœç²‹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚(ä¾‹. Blog ã‚¹ã‚­ãƒ¼ãƒã®å‹å®šç¾©)

```typescript
~çœç•¥;
export const BlogDefSchema = z.object({
  title: z.string(),
  category: OnlyIdSchema.and(z.unknown()),
  author: OnlyIdSchema.and(z.unknown()),
  image: z
    .object({
      url: z.string().url(),
      height: z.number(),
      width: z.number(),
    })
    .optional(),
  body: z.string(),
});
export type BlogDef = z.infer<typeof BlogDefSchema>;

~çœç•¥;

export const BlogOutputSchema = makeListResponseSchema(BlogDefSchema);

~çœç•¥;

export const BlogSchema = BlogOutputSchema.shape.contents.element;

~çœç•¥;

export type Blog = z.infer<typeof BlogSchema>;
```

**3. microcms_sdk_generator ã®æ¨ã—ãƒã‚¤ãƒ³ãƒˆ**

> ã“ã‚Œã‚‰ã®å‹ã‚„ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ API ãŒå¢—ãˆã¦ãã‚‹ã¨ãã‚Œãªã‚Šã«æ™‚é–“çš„ãªã‚³ã‚¹ãƒˆã‚’è²»ã‚„ã™ã“ã¨ã«ãªã‚‹ã®ã§ã™ãŒã€ãã‚‚ãã‚‚ã‚¹ã‚­ãƒ¼ãƒå®šç¾©é–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯æ©Ÿæ¢°çš„ã«è§£é‡ˆã§ãã‚‹ã‚‚ã®ã§ã‚ã‚Šã€äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªã„ã®ã§ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹è‡ªå‹•åŒ–ã‚’å›³ã‚Šã¾ã—ãŸã€‚

ä½œè€…ã®æ–¹ã®è¨˜äº‹ã«ã‚‚æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€microCMS ã® API ãŒè¿”ã™ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‹ã‚’ã¤ã‘ã‚‹ã®ã¯çµæ§‹å¤§å¤‰ãªä½œæ¥­ãªã®ã§ã€API ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã‹ã‚‰å‹å®šç¾©ãŒè‡ªå‹•ã§ç”Ÿæˆã•ã‚Œã‚‹ã®ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã™ã€‚

# GraphQL ã®å‹ã¨ microCMS ã®å‹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã›ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹

ã“ã“ã¾ã§ã§ã€GraphQL Yoga ã®æ§‹ç¯‰ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã®å°å…¥ãŒã§ãã¾ã—ãŸã€‚æœ€å¾Œã«ã€GraphQL ã®å‹ã¨ microCMS ã®å‹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã›ã€ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã‚’ä»•ä¸Šã’ã¾ã™ã€‚

gcg-typescript-resolver-files ã«ã¯ã€ãƒªã‚¾ãƒ«ãƒãƒ¼ãŒæœ€çµ‚çš„ã«è¿”ã™å‹(ã‚¹ã‚­ãƒ¼ãƒ)ã¨ä»–ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã›ã‚‹ãƒãƒƒãƒ‘ãƒ¼ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ã€GraphQL ã® Blog ã‚¹ã‚­ãƒ¼ãƒãŒè¿”ã™å‹ã¨ microCMS ã® Blog API ã‚¹ã‚­ãƒ¼ãƒãŒè¿”ã™å‹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã¾ã™ã€‚ã“ã®éš›ã€ä»¥ä¸‹ã®ã‚ˆã†ã« schema.mappers.ts ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```typescript
// ä¾‹. apps/backend/src/schema/blog/schema.mappers.ts
// ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼šã€€https://github.com/shimabukuromeg/graphql-yoga-sample/blob/main/apps/backend/src/schema/blog/schema.mappers.ts
import { Blog } from "micro-cms-schemas/generated";

export type Blog_Mapper = Blog;
```

https://the-guild.dev/graphql/codegen/docs/guides/graphql-server-apollo-yoga-with-server-preset#adding-mappers

GraphQL ã‚¹ã‚­ãƒ¼ãƒã®å‹ã¨ microCMS ã®å‹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã›ã‚‹ã“ã¨ã§ã€ãƒãƒƒãƒ”ãƒ³ã‚°ã—ãŸ GraphQL ã‚¹ã‚­ãƒ¼ãƒã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¤ã„ã¦ã¯ã€microCMS ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒªã‚¾ãƒ«ãƒãƒ¼å´ã§å¿…é ˆã§è¿”ã•ãªã„ã¨ã„ã‘ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ãŒã€ãƒãƒƒãƒ‘ãƒ¼å´ï¼ˆmicroCMS å´ï¼‰ã§æŒã£ã¦ã„ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€è¿½åŠ ã§ãƒªã‚¾ãƒ«ãƒãƒ¼ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã€GraphQL Blog ã‚¹ã‚­ãƒ¼ãƒã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

**GraphQL Blog ã‚¹ã‚­ãƒ¼ãƒ**

```graphql
# ä¾‹. apps/backend/src/schema/blog/schema.graphql
# ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…: https://github.com/shimabukuromeg/graphql-yoga-sample/blob/main/apps/backend/src/schema/blog/schema.graphql
extend type Query {
  blog(id: ID!): Blog!
}

"""
ãƒ–ãƒ­ã‚°è¨˜äº‹
"""
type Blog {
  id: ID!
  title: String!
  body: String!
  image: MicroCmsImage
  category: Category!
  author: Author!
  createdAt: DateTime!
  updatedAt: DateTime!
  publishedAt: DateTime
  revisedAt: DateTime
}
```

**Blog Query ãƒªã‚¾ãƒ«ãƒãƒ¼**
`microCms.blog.get` ã¯ microcms_sdk_generator ã§ç”Ÿæˆã—ãŸãƒ–ãƒ­ã‚°ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```typescript
// apps/backend/src/schema/blog/resolvers/Query/blog.ts
// ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…: https://github.com/shimabukuromeg/graphql-yoga-sample/blob/main/apps/backend/src/schema/blog/resolvers/Query/blog.ts
import type { QueryResolvers } from "./../../../types.generated";
export const blog: NonNullable<QueryResolvers["blog"]> = async (
  _parent,
  arg,
  ctx
) => {
  const { data } = await ctx.microCms.blog.get({
    id: arg.id,
  });
  return data;
};
```

**Blog Object ãƒªã‚¾ãƒ«ãƒãƒ¼**
author ã¨ category ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ microCMS å´ã®å‹å®šç¾©ã«ã¯å­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ãŒã€Blog ãƒªã‚¾ãƒ«ãƒãƒ¼ã¨ã—ã¦ã¯å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦è¿½åŠ ã§å®Ÿè£…ã—ã¾ã™ã€‚ï¼ˆObject ãƒªã‚¾ãƒ«ãƒãƒ¼ã¯æœ€çµ‚çš„ã«ã‚¯ãƒ©ã‚¢ãƒ³ãƒˆã«è¿”ã™å€¤ã¨ãªã‚Šã¾ã™ã€‚ï¼‰

```typescript
// apps/backend/src/schema/blog/resolvers/Blog.ts
// ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…: https://github.com/shimabukuromeg/graphql-yoga-sample/blob/main/apps/backend/src/schema/blog/resolvers/Blog.ts
import type { BlogResolvers } from "./../../types.generated";
export const Blog: BlogResolvers = {
  /* Implement Blog resolver logic here */
  author: async (parent, arg, ctx) => {
    /* Blog.author resolver is required because Blog.author and Blog_Mapper.author are not compatible */
    const { data } = await ctx.microCms.author.get({
      id: parent.author.id,
    });
    return data;
  },
  category: async (parent, arg, ctx) => {
    const { data } = await ctx.microCms.category.get({
      id: parent.category.id,
    });
    return data;
  },
};
```

ã“ã“ã¾ã§å®Ÿè£…ã—ãŸã‚‰ Yoga Server ã‚’èµ·å‹•ã—ã¦è©¦ã—ã¦ã«ã‚¯ã‚¨ãƒªã‚’å©ã„ã¦ã¿ã¾ã™ã€‚microCMS ãŒãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å…ƒã«ãªã£ã¦ã„ã‚‹ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5f062fe9fe0a-20240303.png)

ã“ã“ã¾ã§ã§ç´¹ä»‹ã—ã¦ããŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»å®Ÿè£…ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¾ã¨ã¾ã£ã¦ã¾ã™ã€‚

https://github.com/shimabukuromeg/graphql-yoga-sample

# ãŠã‚ã‚Šã«

ä»¥ä¸Šã€microCMS ã‚’ GraphQL ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã®ç´¹ä»‹ã§ã—ãŸã€‚å®Ÿéš›ã«ä½¿ã†éš›ã¯ã€N+1 ã‚„ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãªã©ã€ã„ã‚ã„ã‚ã¨è€ƒæ…®ã—ãªã„ã¨ã„ã‘ãªã„ã¨ã“ã‚ãŒã‚ã‚Šãã†ã§ã™ã€‚ãã®ã‚ãŸã‚Šã‚‚ã€æ•´ç†ã§ããŸã‚‰è¨˜äº‹ã«ã¾ã¨ã‚ã¦ã„ããŸã„ã€‚

# å‚è€ƒ

https://zenn.dev/ubie_dev/articles/b1c9258cbf3ceb

https://zenn.dev/shunjuio/articles/e5515872871534
